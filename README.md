# Speech Recognition and Keyword Search Project

## Описание проекта

Этот проект представляет собой программное обеспечение для распознавания речи, поиска ключевых слов в JSON-файле и генерации ответов с использованием синтеза речи. Проект использует библиотеки `vosk`, `gtts`, `pygame`, `pyaudio`, `io` и `json`.

## Основные компоненты проекта

### main.py

Модуль предназначен для распознавания речи с использованием модели Vosk, поиска ответов на распознанные вопросы в JSON-файле и озвучивания найденных ответов. Основные компоненты включают инициализацию модели Vosk, настройку аудиопотока, обработку аудиоданных, распознавание речи и вызов функций для поиска и озвучивания ответов.

### Импортируемые модули и переменные

- `Model`, `KaldiRecognizer` из `vosk`: Компоненты для работы с моделью Vosk.
- `pyaudio`: Библиотека для работы с аудио.
- `calc_response` из `response_module`: Функция для вычисления ответа на распознанный вопрос.
- `speak_text` из `tts_module`: Функция для синтеза речи.

### Описание переменных и объектов

- `model`: Объект модели Vosk, инициализируется с использованием модели `vosk-model-small-ru-0.22`.
- `rec`: Объект распознавателя KaldiRecognizer, инициализируется с моделью и частотой дискретизации 16000 Гц.
- `p`: Объект `pyaudio.PyAudio`, используется для работы с аудиопотоком.
- `stream`: Аудиопоток, настроен на захват аудио с частотой дискретизации 16000 Гц и монофоническим режимом.
- `old_recognized`: Переменная для хранения предыдущего распознанного текста.

### Описание работы модуля

1. **Инициализация модели и распознавателя:**
   - Загружается модель Vosk и создается объект `KaldiRecognizer`.

2. **Настройка аудиопотока:**
   - Открывается аудиопоток с параметрами: формат `paInt16`, один канал, частота дискретизации 16000 Гц, режим ввода, размер буфера 16000.

3. **Запуск аудиопотока:**
   - Аудиопоток запускается для захвата аудиоданных.

4. **Основной цикл обработки:**
   - В бесконечном цикле считываются аудиоданные из потока.
   - Если данные пустые, цикл прерывается.
   - Распознавание речи выполняется с использованием `rec.AcceptWaveform`.
   - Если распознавание успешно, результат обрабатывается и сохраняется в `new_recognized`.
   - Если распознанный текст изменился, обновляется переменная `old_recognized`.
   - Если распознанный текст изменился, вызывается функция `calc_response` для поиска и озвучивания ответа.

5. **Обработка распознанного текста:**
   - Если распознанный текст изменился, вызывается функция `calc_response`, которая ищет ответ в JSON-файле и озвучивает его.

### Модуль `tts_module`

Этот модуль содержит функцию для озвучивания текста.

### Функции модуля:

#### `speak_text(text)`:

 Используется для озвучивания переданного текста с использованием библиотеки gTTS (Google Text-to-Speech) и воспроизведения звука с помощью библиотеки `pygame`.

- **Параметры**:   
	- `text (str)`: Текст для озвучивания. Если текст пустой, будет вызвано исключение ValueError.  
	- `lang (str)`: Язык озвучки, по умолчанию 'ru' (русский).


### Модуль `read_json_module`

Модуль предназначен для чтения JSON-файла, поиска подстроки в массиве словарей с полем request и выполнения заданного действия при нахождении совпадения. Основные функции включают чтение JSON-файла, поиск подстроки и выполнение коллбека при нахождении совпадения.

### Функции модуля

#### `read_json_file(file_path)`

Читает JSON-файл и возвращает данные.

- **Параметры:**
  - `file_path` (str): Путь к JSON-файлу.
- **Возвращает:**
  - Список словарей с полями `request` и `response`.
- **Обработка ошибок:**
  - Если файл не найден, выводится сообщение об ошибке.
  - Если произошла ошибка декодирования JSON, выводится сообщение об ошибке.

#### `search_substring_in_data(data, substring)`

Выполняет поиск включения подстроки в поле `request` каждого словаря в списке.

- **Параметры:**
  - `data` (list): Список словарей с полями `request` и `response`.
  - `substring` (str): Подстрока для поиска.
- **Возвращает:**
  - Список словарей, содержащих подстроку в поле `request`.

#### `search_and_execute(file_path, substring, callback)`

Ищет подстроку в JSON-файле и выполняет коллбек при успешном нахождении.

- **Параметры:**
  - `file_path` (str): Путь к JSON-файлу.
  - `substring` (str): Подстрока для поиска.
  - `callback` (function): Функция, которая будет вызвана для найденной записи.
- **Описание:**
  - Читает данные из JSON-файла.
  - Ищет подстроку в поле `request`.
  - Если найдено совпадение, вызывает переданную функцию `callback` для первой найденной записи.
  - Если совпадение не найдено, выводит сообщение об этом.
  - Если данные из файла не удалось прочитать, выводит сообщение об ошибке.


### Модуль `response_module`

Модуль предназначен для распознавания и обработки вопросов, поиска соответствующих ответов в JSON-файле и генерации ответа через синтез речи. Основные компоненты включают чтение JSON-файла, поиск подстроки, выполнение коллбека и синтез речи.

### Импортируемые модули и переменные

- `search_and_execute` из `read_json_module`: Функция для поиска подстроки в JSON-файле и выполнения коллбека.
- `speak_text` из `tts_module`: Функция для синтеза речи.
- `additional_message`: Переменная с дополнительным сообщением, которое добавляется к каждому ответу.
- `file_path`: Путь к JSON-файлу с данными.

### Описание функций

#### `response_callback(entry)`

Функция-коллбек для обработки найденной записи.

- **Параметры:**
  - `entry` (dict): Найденная запись с полями `request` и `response`.
- **Описание:**
  - Использует функцию `speak_text` для озвучивания ответа, добавляя к нему `additional_message`.

#### `calc_response(question)`

Вычисляет ответ на заданный вопрос.

- **Параметры:**
  - `question` (str): Текст вопроса.
- **Описание:**
  - Проверяет, не является ли вопрос пустым.
  - Если вопрос не пустой, использует функцию `search_and_execute` для поиска подстроки в JSON-файле.
  - В случае нахождения совпадения вызывает `response_callback`.

### Работа модуля

1. **Инициализация переменных:** 
   - Задает путь к JSON-файлу (`file_path`).
   - Определяет дополнительное сообщение (`additional_message`).

2. **Функция `response_callback`:**
   - Озвучивает найденный ответ и добавляет к нему дополнительное сообщение.

3. **Функция `calc_response`:**
   - Проверяет наличие вопроса.
   - Выполняет поиск вопроса в JSON-файле.
   - При нахождении совпадения вызывает функцию `response_callback`.

## Установка библиотек

```sh
pip install vosk gtts pygame pyaudio